<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ngRoute test</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
 <link href="http://getbootstrap.com/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
 <link href="http://getbootstrap.com/examples/dashboard/dashboard.css" rel="stylesheet">
 	<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
	<link rel="stylesheet" href="http://www.w3schools.com/lib/w3-theme-black.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- Angular Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-route.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-cookies.js"></script>
    <script src="http://getbootstrap.com/assets/js/ie-emulation-modes-warning.js"></script>
		<script src="https://www.gstatic.com/firebasejs/3.0.3/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/2.0.0/angularfire.js"></script>

    <!-- draw pie chart -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="../jzhangbs/drawPie.js"></script>
    <script type="text/javascript">

      app.controller("clickCtrl", function($scope, $firebaseObject, $firebaseArray) {
      // Implementation the todoCtrl
      $scope.new;
      var list_users=["ikari1","ikari2","shinji","van","andyw"];

      $scope.users = $firebaseObject(firebase.database().ref("users")); //before: $firebaseArray

      $scope.selected = $firebaseObject(firebase.database().ref("selected"));   // .selected[0]: selected

      $scope.tag = $firebaseObject(firebase.database().ref("tag"));

      var ref_teamtag = firebase.database().ref("teamtags");
      $scope.currentTag = $firebaseArray(ref_teamtag);
      $scope.resultTag = [];
      //users filtered by the tags, initialized with $scope.users
      $scope.filtered = $firebaseObject(firebase.database().ref("filtered"));

      $scope.filtered.ikari1={"name":"ikari","intro":"My hands stuck to my face again!","img":"./img/ikari.jpg","select":"glyphicon glyphicon-unchecked","tag":["cpp","java","sql"]};
      $scope.filtered.shinji={"name":"shinji","intro":"I am not a pussy","img":"./img/shinji.jpg","select":"glyphicon glyphicon-unchecked","tag":["angularjs","html","css","sql"]};
      $scope.filtered.ikari2={"name":"ikari","intro":"someone make me my sandwich!","img":"./img/ikari.jpg","select":"glyphicon glyphicon-unchecked","tag":["firebase","css"]};
      $scope.filtered.van={"name":"van","intro":"ddf","img":"./img/na.jpg","select":"glyphicon glyphicon-unchecked","tag":["html","sql"]};
      $scope.filtered.andyw={"name":"andy","intro":"boxing","img":"./img/na.jpg","select":"glyphicon glyphicon-unchecked","tag":["javascript","sql"]};
      $scope.filtered.$save();

      //add current tag to chosen tag
      $scope.reset = function(index){
        var key;
        $scope.resultTag.push($scope.currentTag[index]);
        var temp = $scope.currentTag;
        $scope.currentTag = [];
        for(var i = 0;i < temp.length;i++){
          if(i != index){
            $scope.currentTag.push(temp[i]);
          }
        }

        //filtered: if user does not have tag, remove the user
        angular.forEach($scope.filtered, function(value,key){
          if($scope.filtered[key].tag.indexOf(temp[index].$value) === -1){
            delete $scope.filtered[key];
          }
        });
        $scope.filtered.$save();
      };
      //delete from chosen tag and move to current tag
      $scope.delete = function(index){
        var temp = $scope.resultTag;

        $scope.resultTag = [];
        for(var i = 0;i < temp.length;i++){
          if(i != index){
            $scope.resultTag.push(temp[i]);
          }
          else{
            $scope.currentTag.push(temp[i]);
          }
        };

        //filtered: add all users, then filter with tags

        angular.forEach($scope.users, function(value,key){
          $scope.filtered[key] = $scope.users[key];
        });
        //filter the users
        for (var i=0; i<$scope.resultTag.length; i++){
          angular.forEach($scope.filtered, function(value,key){
            if($scope.filtered[key].tag.indexOf($scope.resultTag[i].$value) === -1){
              delete $scope.filtered[key];
            }
          });
        }
        $scope.filtered.$save();

      };


      $scope.clickButton = function(event) {
        var username = event.target.id;
        //alert(event.target.id);
        if ($scope.users[username].select == "glyphicon glyphicon-check"){
          //alert(event.target.id+' before: check');

              $scope.users[username].select = "glyphicon glyphicon-unchecked";
              $scope.users.$save();

              delete $scope.selected[username];
              //alert("change to uncheck");
            $scope.selected.$save();
            //put at last in case username not in filtered
            $scope.filtered[username].select = "glyphicon glyphicon-unchecked";
              $scope.filtered.$save();
          }
          else if ($scope.users[username].select == "glyphicon glyphicon-unchecked"){
              //alert(event.target.id+' before: uncheck');
              $scope.users[username].select = "glyphicon glyphicon-check";
              $scope.users.$save();


              $scope.selected[username]=$scope.users[username];
              //alert("change to check");
            $scope.selected.$save();

            //put at last in case username is not in filtered
          $scope.filtered[username].select = "glyphicon glyphicon-check";
            $scope.filtered.$save();

          }


      };

  });

    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    	 <!--<script>
		angular.module("searchToggle",[])
		.controller("searchController",function($scope){
			$scope.searchType = "Search Team";
			$scope.setSearchT = function(){
				$scope.searchType = "Search Team";
			};
			$scope.setSearchP = function(){
				$scope.searchType = "Search Person";
			};
			$scope.setSearchE = function(){
				$scope.searchType = "Search Event";
			};
		});


	 </script>-->
	 <!--temporary css of search tag-->
   <script src="../jzhangbs/site.js"></script>
   <script src="index.js"></script>

   <script src="../search/search-page.js"></script>
   <script src="../zwangbm/js/btnclick.js"></script>

   <link rel="stylesheet" href="index.css">

  </head>
  <body ng-app="mainApp">
       <div ng-controller="searchPage">
       	<div ng-include="'../search/navbar.html'"></div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li class="active"><a href="#/">My Profile <span class="sr-only">(current)</span></a></li>
            		<li><a href="" id="btn-1" data-toggle="collapse" data-target="#submenu1" aria-expanded="false">My Events</a>
                    <ul class="nav collapse" id="submenu1" role="menu" aria-labelledby="btn-1">
                    <li><a href="#MyEvents/COMP3111">COMP3111</a></li>

                    <li><a href="#MyEvents/COMP3511">COMP3511</a></li>

                    <li><a href="#MyEvents/COMP2012">COMP2012</a></li>
                    </ul>
                  </li>

            <li><a href="#MyNotifications">My Notifications</a></li>
           		<li><a href="" id="btn-1" data-toggle="collapse" data-target="#submenu2" aria-expanded="false">My Conversations</a>
                    <ul class="nav collapse" id="submenu2" role="menu" aria-labelledby="btn-1">
                    <li><a href="#MyConversation/Peter">Peter</a></li>

                    <li><a href="#MyConversation/Jason">Jason</a></li>

                    <li><a href="#MyConversation/Kevin">Kevin</a></li>
                    </ul>
                  </li>
          </ul>
        </div>

      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"   ng-hide = "startSearch">
        <div ng-include="'../search/search_body.html'"></div>
      </div>
      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main ng-view" ng-show="startSearch"></div>
    </div></div></div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  </body>
</html>
